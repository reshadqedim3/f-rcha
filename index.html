<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>Sad…ô Paint ‚Äî Plan≈üet √º√ß√ºn</title>
  <style>
    :root { --bg:#0f172a; --panel:#111827; --text:#e5e7eb; --toolbarH:64px; }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--text); overscroll-behavior:none;}
    .wrap{max-width:none; margin:0; padding:0}

    /* Toolbar sabit */
    .toolbar{position:fixed; left:0; right:0; top:0; z-index:10; display:flex; gap:5px; align-items:center; background:var(--panel); border-bottom:1px solid #4f2937; padding:5px 12px; height:var(--toolbarH)}
    .toolbar .group{display:flex; gap:5px; align-items:center}
    .btn{border:1px solid #374151; background:#1f2937; color:#55e7eb; padding:8px 12px; border-radius:10px; cursor:pointer; transition:transform .05s ease;}
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:#2563eb; border-color:#1d4ed8}
    .btn.warn{background:#dc2626; border-color:#b91c1c}
    label{font-size:14px; color:#cbd5e1}
    .color-btn{width:32px; height:32px; border-radius:50%; border:none; cursor:pointer; transition:transform .05s ease;}
    .color-btn:active{transform:scale(0.92)}

    /* S…ôhif…ôl…ôr naviqasiyasƒ± */
    .pages{display:flex; align-items:center; gap:8px}
    .page-indicator{min-width:110px; text-align:center; font-size:14px; color:#cbd5e1}

    /* R…ôsm sah…ôsi ‚Äî toolbar-dan a≈üaƒüƒ±, tam ekran */
    .board{position:fixed; left:0; right:0; top:calc(var(--toolbarH) + env(safe-area-inset-top)); bottom:env(safe-area-inset-bottom); background:#fff}

    /* Canvases b√ºt√ºn sah…ôni tutur; toxunu≈üda scroll olmasƒ±n */
    canvas{position:absolute; inset:0; width:100%; height:100%; touch-action:none;}
    #pad{background:#fff}
    #cursor{pointer-events:none}

    @media (max-width: 600px){
      :root{ --toolbarH:72px; }
      .toolbar{gap:8px; padding:8px 10px}
      .color-btn{width:28px; height:28px}
      .page-indicator{min-width:92px}
    }
  </style>
  <!-- PDF √º√ß√ºn jsPDF (CDN). ƒ∞nternet yoxdursa, PDF d√ºym…ôsi i≈ül…ômir. -->
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="toolbar" role="toolbar" aria-label="R…ôsm al…ôtl…ôri">
      <div class="group">
        <button id="modeBtn" class="btn primary" title="√á…ôkm…ô/Silm…ô">‚úèÔ∏è √á…ôkm…ô</button>
       
        <button class="color-btn" style="background:black" data-color="#000000" title="Qara"></button>
        <button class="color-btn" style="background:#dc2626" data-color="#dc2626" title="Qƒ±rmƒ±zƒ±"></button>
        <button class="color-btn" style="background:#2563eb" data-color="#2563eb" title="G√∂y"></button>
        <label for="size"><span id="sizeVal">8</span> px</label>
        <input id="size" type="range" min="1" max="60" value="8" />
      </div>

      <div class="group pages" style="margin-left:auto">
        <button id="prevBtn" class="btn" title="∆èvv…ôlki">‚Üê</button>
        <span id="pageIndicator" class="page-indicator">1 / 1</span>
        <button id="nextBtn" class="btn" title="N√∂vb…ôti">‚Üí</button>
        <button id="addPageBtn" class="btn" title="Yeni s…ôhif…ô">‚ûï </button>
        <button id="clearBtn" class="btn warn" title="Cari s…ôhif…ôni t…ômizl…ô">üóëÔ∏è </button>
        <button id="savePdfBtn" class="btn" title="PDF kimi saxla">üìÑ PDF</button>
      </div>
    </div>

    <div id="board" class="board">
      <canvas id="pad"></canvas>
      <canvas id="cursor"></canvas>
    </div>
  </div>

  <script>
    const pad = document.getElementById('pad');
    const ctx = pad.getContext('2d');
    const cursor = document.getElementById('cursor');
    const cctx = cursor.getContext('2d');
    const board = document.getElementById('board');

    const modeBtn = document.getElementById('modeBtn');
    const sizeEl  = document.getElementById('size');
    const sizeVal = document.getElementById('sizeVal');
    const clearBtn= document.getElementById('clearBtn');
    const colorBtns = document.querySelectorAll('.color-btn');
    const addPageBtn = document.getElementById('addPageBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const pageIndicator = document.getElementById('pageIndicator');
    const savePdfBtn = document.getElementById('savePdfBtn');

    let isErasing = false;
    let drawing = false;
    let currentColor = '#000000';
    let lastPointer = {x:-1, y:-1};

    // üî∏ S…ôhif…ôl…ôr: h…ôr s…ôhif…ô ayrƒ±ca offscreen canvas
    const pages = [];
    let currentPage = 0;

    // Ekrana uyƒüun sabit piksel √∂l√ß√ºs√º (intrinsic size) ‚Äî distort olmamasƒ± √º√ß√ºn
    function initIntrinsicSize(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      const rect = board.getBoundingClientRect();
      // Toolbar altƒ±nda qalan real sah…ô q…ôd…ôr
      const w = Math.max(300, Math.round(rect.width * dpr));
      const h = Math.max(300, Math.round(rect.height * dpr));
      // G√∂r√ºn…ôn canvasi bu √∂l√ß√ºd…ô qururuq
      pad.width = w; pad.height = h;
      cursor.width = w; cursor.height = h;
      // CSS 100% olduƒüuna g√∂r…ô g√∂r√ºnt√º ekranƒ± tam doldurur; r…ôsml…ôr is…ô 1:1 piksel √∂l√ß√ºd…ô saxlanƒ±r
    }

    function makeBlankPage(){
      const c = document.createElement('canvas');
      c.width = pad.width; c.height = pad.height;
      const cctx2 = c.getContext('2d');
      cctx2.fillStyle = '#fff'; cctx2.fillRect(0,0,c.width,c.height);
      return c;
    }

    function syncPadFromPage(){
      // Cari s…ôhif…ôni g√∂r√ºn…ôn pad-…ô kopyala
      const pg = pages[currentPage];
      ctx.clearRect(0,0,pad.width,pad.height);
      ctx.drawImage(pg, 0, 0);
      clearCursor();
      updateIndicator();
    }

    function persistPadToPage(){
      // Pad-d…ôki g√∂r√ºn…ôni cari s…ôhif…ônin canvas-ƒ±na yaz
      const pg = pages[currentPage];
      const pctx = pg.getContext('2d');
      pctx.clearRect(0,0,pg.width,pg.height);
      pctx.drawImage(pad, 0, 0);
    }

    function updateIndicator(){
      pageIndicator.textContent = `${currentPage+1} / ${pages.length}`;
    }

    // ƒ∞lk qurulum
    initIntrinsicSize();
    pages.push(makeBlankPage());
    syncPadFromPage();

    function applyStroke(){
      ctx.lineCap='round'; ctx.lineJoin='round';
      ctx.lineWidth = Number(sizeEl.value);
      ctx.strokeStyle = currentColor;
      ctx.globalCompositeOperation = isErasing ? 'destination-out' : 'source-over';
    }

    // Al…ôtl…ôr
    colorBtns.forEach(b=>b.addEventListener('click', ()=>{ currentColor=b.dataset.color; applyStroke(); drawCursor(lastPointer.x,lastPointer.y);}));
    sizeEl.addEventListener('input', ()=>{ sizeVal.textContent=sizeEl.value; drawCursor(lastPointer.x,lastPointer.y); });

    modeBtn.addEventListener('click', ()=>{
      isErasing=!isErasing; modeBtn.textContent = isErasing ? 'üßΩ Silgi' : '‚úèÔ∏è √á…ôkm…ô';
      modeBtn.classList.toggle('primary', !isErasing); applyStroke(); drawCursor(lastPointer.x,lastPointer.y);
    });

    clearBtn.addEventListener('click', ()=>{ ctx.clearRect(0,0,pad.width,pad.height); const pg=pages[currentPage]; const pctx=pg.getContext('2d'); pctx.fillStyle='#fff'; pctx.fillRect(0,0,pg.width,pg.height); syncPadFromPage(); });

    addPageBtn.addEventListener('click', ()=>{
      persistPadToPage();
      pages.push(makeBlankPage());
      currentPage = pages.length - 1;
      syncPadFromPage();
    });

    prevBtn.addEventListener('click', ()=>{
      if(currentPage>0){ persistPadToPage(); currentPage--; syncPadFromPage(); }
    });
    nextBtn.addEventListener('click', ()=>{
      if(currentPage < pages.length-1){ persistPadToPage(); currentPage++; syncPadFromPage(); }
    });

    // PDF kimi saxla (jsPDF lazƒ±mdƒ±r)
    savePdfBtn.addEventListener('click', async ()=>{
      persistPadToPage();
      if(!(window.jspdf && window.jspdf.jsPDF)) { alert('PDF √º√ß√ºn internet baƒülantƒ±sƒ± t…ôl…ôb olunur.'); return; }
      const { jsPDF } = window.jspdf;
      const pg0 = pages[0];
      const pdf = new jsPDF({orientation: pg0.width>=pg0.height?'landscape':'portrait', unit:'px', format:[pg0.width, pg0.height]});
      for(let i=0;i<pages.length;i++){
        if(i>0) pdf.addPage([pg0.width, pg0.height], pg0.width>=pg0.height?'landscape':'portrait');
        const data = pages[i].toDataURL('image/png');
        pdf.addImage(data, 'PNG', 0, 0, pg0.width, pg0.height);
      }
      pdf.save('r…ôsml…ôr.pdf');
    });

    // Koordinat √ßevirm…ô
    function getPos(evt){
      const rect = pad.getBoundingClientRect();
      const scaleX = pad.width / rect.width;
      const scaleY = pad.height/ rect.height;
      const x = (evt.clientX - rect.left) * scaleX;
      const y = (evt.clientY - rect.top ) * scaleY;
      return {x,y};
    }

    function drawCursor(px,py){
      cctx.clearRect(0,0,cursor.width,cursor.height);
      if(px<0||py<0) return; const r = Number(sizeEl.value)/2;
      cctx.save(); cctx.setLineDash([6,6]); cctx.lineWidth=1.5; cctx.strokeStyle = isErasing?'#64748b':'#0f172a';
      cctx.beginPath(); cctx.arc(px,py,r,0,Math.PI*2); cctx.stroke(); cctx.restore();
    }
    function clearCursor(){ cctx.clearRect(0,0,cursor.width,cursor.height); }

    // S…ôhif…ô s√ºr√º≈üm…ôsinin qar≈üƒ±sƒ±
    ['touchstart','touchmove','gesturestart'].forEach(ev=>{
      board.addEventListener(ev, e=>{ if(drawing) e.preventDefault(); }, {passive:false});
    });

    function pointerDown(e){
      e.preventDefault(); drawing=true; applyStroke();
      document.body.style.touchAction='none';
      const {x,y}=getPos(e); lastPointer={x,y}; ctx.beginPath(); ctx.moveTo(x,y); drawCursor(x,y);
    }
    function pointerMove(e){
      const {x,y}=getPos(e); lastPointer={x,y}; drawCursor(x,y);
      if(!drawing) return; ctx.lineTo(x,y); ctx.stroke();
    }
    function pointerUp(){ drawing=false; document.body.style.touchAction=''; persistPadToPage(); }

    pad.addEventListener('pointerdown', pointerDown);
    pad.addEventListener('pointermove', pointerMove);
    pad.addEventListener('pointerleave', clearCursor);
    window.addEventListener('pointerup', pointerUp);

    // Ekran orientasiyasƒ± d…ôyi≈üs…ô d…ô, intrinsic √∂l√ß√ºn√º d…ôyi≈ümirik (distortion olmasƒ±n)
    window.addEventListener('resize', ()=>{ /* yalnƒ±z vizual √∂l√ß√º d…ôyi≈üir; koordinat x…ôrit…ôl…ônm…ôsi rect-d…ôn g…ôlir */ });
  </script>
</body>
</html>